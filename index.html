<!DOCTYPE html>
<html lang="ja" dir="ltr">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=470,initial-scale=1">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="refresh" content="3600">
		<link rel="stylesheet" type="text/css" href="./lib/master.css" />
		<title>n138-kz.github.io</title>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<script src="https://accounts.google.com/gsi/client" async defer></script>
		<script src="https://www.google.com/recaptcha/api.js?render=6LfCHdcUAAAAAOwkHsW_7W7MfoOrvoIw9CXdLRBA"></script>
		<script src="./lib/grecaptcha.js"></script>
		<script src="./lib/random.js"></script>
		<script>
			function UserException(message) {
				this.iat = new Date().getTime()/1000;
				this.message = message;
				/*
				/* throw new UserException('test'); * /
				console.error(e);
				object = document.createElement('p');
				object.innerText  = ''
				object.innerText += JSON.stringify(e);
				object.style.color = '#fff';
				object.style.backgroundColor = '#f00';
				object.style.marginTop = '0';
				object.style.marginBottom = '0';
				document.body.appendChild(object);
				*/
			}
		</script>
		<style>
			@font-face {
				font-family: "Uzura font";
				src: 
					local("うずらフォント"),
					local("uzura_font"),
					url("https://n138-kz.github.io/lib/uzura.ttf") format("truetype");
			}
			@font-face {
				font-family: "Azuki font";
				src: 
					local("あずきフォント"),
					local("azuki_font"),
					url("https://n138-kz.github.io/lib/azuki.ttf") format("truetype");
			}
			@font-face {
				font-family: "Myrica font";
				src: 
					local("Myrica M"),
					local("Myrica N"),
					local("Myrica P"),
					url("https://n138-kz.github.io/lib/Myrica.ttc") format("truetype");
			}
			:root {
				--default-font-size: 16pt;
				--default-margin-padding-size: 0;
				--default-background-color: #F0FFFFFF;
				--default-text-color: #000000FF;
			}
			html {
				background-color: var(--default-background-color);
				color: var(--default-text-color);
				font-size: var(--default-font-size);
			}
			html, body {
				margin: var(--default-margin-padding-size);
				padding: var(--default-margin-padding-size);
			}
			h1, h2, h3, h4, h5, h6 {
				margin-top: 10px;
				margin-bottom: 0;
			}
			@media not screen {
				:root {
					display: none;
				}
			}
		</style>
		<style>
			h1, h2, h3, h4, h5, h6 {
				font-family: "Uzura font";
			}
			code {
				background-color: silver;
				vertical-align: middle;
				font-family: "Myrica font", monospace;
			}
			li {
				font-family: "Azuki font";
			}
			footer {
				font-family: "Azuki font";
			}
			footer span {
				display: inline-flex;
			}
		</style>
		<style>
			.icon img {
				height: 1em;
				margin-right: 1ex;
			}
			.flex {
				display: flex;
			}
			@media screen and (max-width: 560px) and (orientation: portrait) {
				.flex {
					display: flex;
					text-align: center;
				}
			}
			.font_azuki {
				font-family: "Azuki font";
			}
			.font_uzura {
				font-family: "Uzura font";
			}
			.font_myrica {
				font-family: "Myrica font";
			}
			body>div[class] {
				font-size: 24pt;
			}
		</style>
		<script>
			async function hash_encode(encode='SHA-256', text='') {
				/**
				* @docs
					https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest
				* @args encode::text
					- SHA-1
					- *SHA-256
					- SHA-384
					- SHA-512
				* @args text::text
					.*
				*/
				const uint8  = new TextEncoder().encode(text)
				const digest = await crypto.subtle.digest(encode, uint8)
				return Array.from(new Uint8Array(digest)).map(v => v.toString(16).padStart(2,'0')).join('')
			}
		</script>
		<script src="./lib/master.js"></script>
		<script>
			function createNLevelHeader(level=2, text='') {
				if ( ! isNumber(level) ) { level=2; }
				if ( level<1 ) { level=2; }
				if ( level>6 ) { level=6; }
				const domobject=document.createElement('h'+level);
				const innerText=document.createTextNode(text);
				domobject.appendChild(innerText);
				return domobject; /* <-- i.e. document.body.appendChild( createNLevelHeader() ); */
			}
			function insertSignature() {
				dom_item = [];
				dom_item[0] = document.createElement('footer');
				dom_item[1] = document.createElement('span');
				dom_item[2] = document.createTextNode( 'Copyright(c) ' + (new Date()).getFullYear() + ', n138.nws. All right reserved.' );
				dom_item[1].appendChild( dom_item[2] );
				dom_item[0].appendChild( dom_item[1] );

				dom_item[1] = document.createElement('br');
				dom_item[2] = null;
				dom_item[0].appendChild( dom_item[1] );

				/*
				dom_item[1] = document.createElement('a');
				dom_item[1].href = 'https://github.com/n138-kz/n138-kz.github.io/edit/master/index.html';
				dom_item[2] = document.createTextNode( 'Improve this page.' );
				dom_item[1].appendChild( dom_item[2] );
				dom_item[0].appendChild( dom_item[1] );
    			*/
				
				dom_item[1] = document.createElement('a');
				dom_item[1].id = 'jstClock'
				dom_item[1].href = 'javascript:void(0)'
				dom_item[1].href = 'https://www.n138.jp/'
				dom_item[1].href = '//' + location.host
				dom_item[1].href = 'javascript:buildDebugField();'
				dom_item[1].innerText = ''
				dom_item[2] = null;
				dom_item[0].appendChild( dom_item[1] );

				document.body.appendChild( dom_item[0] );

				sessionStorage.setItem( (btoa(location.href)).slice(0, 16) + '.'+'setInterval' + '.' + 'jstClock', setInterval( jstClock_set, 1000 ) );
			}
			function jstClock_set() {
				jstClock1=new Date();
				jstClock2={
					hours  : ('00' + jstClock1.getHours()  ).substr(-2),
					minutes: ('00' + jstClock1.getMinutes()).substr(-2),
					seconds: ('00' + jstClock1.getSeconds()).substr(-2),
					year   : ('00' + jstClock1.getFullYear()  ).substr(-4),
					month  : jstClock1.toLocaleString('en-us', { month: 'short' }),
					date   : ('00' + jstClock1.getDate()).substr(-2),
					times  : parseInt(jstClock1.getTime()/1000),
				}

				document.querySelector('#jstClock').innerText=`${jstClock2.hours}:${jstClock2.minutes}:${jstClock2.seconds}`;
				document.querySelector('#jstClock').innerText=parseInt(jstClock2.hours) + ':' + jstClock2.minutes + ':' + jstClock2.seconds;
				document.querySelector('#jstClock').innerText=parseInt(jstClock2.hours) + ':' + jstClock2.minutes + ':' + jstClock2.seconds
					+ ', ' + jstClock2.date + '/' + jstClock2.month + '/' + jstClock2.year;
				document.querySelector('#jstClock').innerText=parseInt(jstClock2.hours) + ':' + jstClock2.minutes + ':' + jstClock2.seconds
					+ ', ' + jstClock2.month + '/' + jstClock2.date + ' ' + jstClock2.year;
			}
			async function getSelfHashThenSetStorage(algos='SHA-1') {
				fetch(location.href)
				.then((r)=>r.text())
				.then((r)=>{
					return hash_encode(algos, r);
				})
				.then((r)=>{
					return {timestamp: parseInt(new Date().getTime()/1000, 10), hashdata: r};
				})
				.then((r)=>{
					const prev_selfhash = JSON.parse(sessionStorage.getItem( (btoa(location.href)).slice(0, 16) + '.'+'selfhash'));
					if ( ! prev_selfhash ) { return r; }
					if ( prev_selfhash.hashdata === r.hashdata ) {
						return prev_selfhash;
					} else {
						if ( ! typeof reload !== 'undefined' ) {
							location.replace(location.href);
						} else {
							let reload;
						}
						return r;
					}
				})
				.then((r)=>{
					sessionStorage.setItem( (btoa(location.href)).slice(0, 16) + '.'+'selfhash', JSON.stringify(r));
					console.debug(r);
				})
				.catch((e)=>{
					console.error(e);
				})
			}
			/*
			Todo:
			10秒ごとにリソースの更新確認実施
			更新有無：hash(sha1)値を確認し、違ったら更新されていると判断
			更新されている場合はページをリロードする
			*/
			setInterval( getSelfHashThenSetStorage, 10000 );
		</script>
		<script>
			function insertNavigation() {
				fetch('./sections.json', {
					method: 'GET',
					mode: 'cors',
					cache: 'no-cache',
					headers: {
						'Content-Type': 'application/json'
					},
					redirect: 'follow',
					referrerPolicy: 'no-referrer',
				})
				.then((res)=>res.json())
				.then((res)=>{ console.log(res); return res; })
				.then((res)=>{
					console.log(res);
					let sections = res;

					dom_item = [];
					dom_item[0] = document.createElement('div');
					dom_item[0].id = 'n138kzNavigationLinks';
					dom_item[0].dataset.id = getRandomLowerString(16);
					Array.from( document.querySelectorAll( '#' + dom_item[0].id ) ).map( (item)=>{
						console.debug(item);
						item.remove();
					} )
					dom_item[0].appendChild(createNLevelHeader(2, 'Navi'));
					document.body.appendChild(dom_item[0]);
					
					sections.map( (item)=>{
						dom_item[1] = document.createElement('div');
						dom_item[1].style.paddingLeft = '5ex';
						dom_item[1].classList.add('flex');
						dom_item[1].classList.add('navi');
						dom_item[1].classList.add('font_azuki');
						dom_item[2] = document.createElement('a');
						dom_item[2].classList.add('icon');
						dom_item[2].href = item.href;
						dom_item[3] = document.createElement('img');
						dom_item[3].alt = '';
						dom_item[3].src = item.favicon;
						dom_item[2].appendChild( dom_item[3] );
						dom_item[3] = document.createTextNode( item.name );
						dom_item[2].appendChild( dom_item[3] );
						dom_item[1].appendChild( dom_item[2] );
						Array.from( document.querySelectorAll( '#' + dom_item[0].id ) ).map( (item)=>{
							item.appendChild(dom_item[1]);
						} )
					} )
					return res;
				})
			}
			async function getListOfGithubPublicReposList(url) {
				/*
				* @inspire: {
				- https://zenn.dev/kawaxumax/articles/0044a0e30536e2
				}
				*/
				const opt = {
					method: 'GET',
					mode: 'cors',
					cache: 'no-cache',
					headers: {
						'Content-Type': 'application/json'
					},
					redirect: 'follow',
					referrerPolicy: 'no-referrer',
				}
				const xml = await fetch(url);
				const res = await xml.json();
				/*
				console.log(xml); // => Response
				console.log(new Date().getTime(),res); // => json
				*/
				return await res;
			}
			async function getListOfGithubPublicRepos() {
				const res = await getListOfGithubPublicReposList('https://api.github.com/users/n138-kz/repos?sort=name&per_page=100');
				console.debug(res);

				fetch('https://api.github.com/users/n138-kz/repos?sort=name&per_page=100', {
					method: 'GET',
					mode: 'cors',
					cache: 'no-cache',
					headers: {
						'Content-Type': 'application/json'
					},
					redirect: 'follow',
					referrerPolicy: 'no-referrer',
				})
				.then((r)=>r.json())
				.then((r)=>{
					r.map( (item)=>{
						console.debug([
							item.name,
							item.html_url,
						]);
					} )
					return r;
				})
				.then((r)=>{
					dom_item = [];
					dom_item[0] = document.createElement('div');
					dom_item[0].id = 'GithubPublicRepos';
					dom_item[0].dataset.id = getRandomLowerString(16);
					Array.from( document.querySelectorAll( '#' + dom_item[0].id ) ).map( (item)=>{
						console.debug(item);
						item.remove();
					} )
					dom_item[0].appendChild(createNLevelHeader(2, 'GitHub Public Repos'));
					document.body.appendChild(dom_item[0]);
					
					r.map( (item)=>{
						console.debug(item);
						dom_item[1] = document.createElement('li');
						dom_item[1].style.paddingLeft = '5ex';
						dom_item[2] = document.createElement('a');
						dom_item[2].innerText = '【GitHub】';
						dom_item[2].href = item.html_url;
						dom_item[2].target = 'sw' + (new Date().getTime()) + (Math.random() * 65536);
						dom_item[2].dataset.url_github = item.html_url;
						dom_item[2].dataset.url_pages = item.homepage;
						dom_item[2].dataset.date_created = item.created_at;
						dom_item[2].dataset.date_updated = item.updated_at;
						dom_item[2].dataset.repos_node_id = item.node_id;
						dom_item[2].dataset.repos_id = item.id;
						dom_item[2].dataset.repos_size = item.size;
						dom_item[2].dataset.repos_language = item.language;
						dom_item[2].dataset.repos_hooks_url = item.hooks_url;
						dom_item[2].dataset.repos_open_issues = item.open_issues_count;

						dom_item[1].appendChild( dom_item[2] );
						
						item.name = (item.name.length > 30) ? item.name.substr(0, 30)+'...' : item.name;
						dom_item[2] = document.createElement('a');
						dom_item[2].innerText = item.name;
						dom_item[2].href = item.homepage;
						dom_item[2].target = 'sw' + (new Date().getTime()) + (Math.random() * 65536);
						dom_item[1].appendChild( dom_item[2] );
						
						Array.from( document.querySelectorAll( '#' + dom_item[0].id ) ).map( (item)=>{
							item.appendChild(dom_item[1]);
						} )
					} )
					return r;
				})
				.then((r)=>{
					insertLastElement();
				})
			}
			function buildDebugField() {
				dom_item = [];
				dom_item[0] = document.createElement('div');
				dom_item[0].id = 'DebugInfoArea';
				dom_item[0].dataset.id = getRandomLowerString(16);
				Array.from( document.querySelectorAll( '#' + dom_item[0].id ) ).map( (item)=>{
					console.debug(item);
					item.remove();
				} )
				dom_item[0].appendChild(createNLevelHeader(2, 'Debug info'));
				document.body.appendChild(dom_item[0]);

				dom_item[1] = document.createElement('div');
				dom_item[1].style.paddingLeft = '5ex';
				dom_item[1].classList.add('debug');
				dom_item[1].classList.add('font_azuki');

				dom_item[2] = document.createElement('table');
				dom_item[2].border = 1;
				dom_item[2].style.maxWidth = '500px';
					dom_item[3] = document.createElement('thead');
						dom_item[4] = document.createElement('tr');
							dom_item[5] = document.createElement('th');
								dom_item[6] = document.createTextNode( 'Item name' );
							dom_item[5].appendChild( dom_item[6] );
						dom_item[4].appendChild( dom_item[5] );
							dom_item[5] = document.createElement('th');
								dom_item[6] = document.createTextNode( 'Value' );
							dom_item[5].appendChild( dom_item[6] );
						dom_item[4].appendChild( dom_item[5] );
					dom_item[3].appendChild( dom_item[4] );

					dom_item[2].appendChild( dom_item[3] );
					dom_item[3] = document.createElement('tbody');
						dom_item[4] = document.createElement('tr');
							dom_item[5] = document.createElement('td');
								dom_item[6] = document.createTextNode( 'Screen width/length' );
							dom_item[5].appendChild( dom_item[6] );
						dom_item[4].appendChild( dom_item[5] );
							dom_item[5] = document.createElement('td');
							dom_item[5].innerHTML  = `${document.body.clientWidth}x${document.body.clientHeight} px<sup>2</sup><br />`;
						dom_item[4].appendChild( dom_item[5] );
					dom_item[3].appendChild( dom_item[4] );

					dom_item[2].appendChild( dom_item[3] );
					dom_item[3] = document.createElement('tbody');
						dom_item[4] = document.createElement('tr');
							dom_item[5] = document.createElement('td');
								dom_item[6] = document.createTextNode( 'Rendered at' );
							dom_item[5].appendChild( dom_item[6] );
						dom_item[4].appendChild( dom_item[5] );
							dom_item[5] = document.createElement('td');
							dom_item[6] = new Date();
							dom_item[7] = [
								 ( ''   + dom_item[6].getHours()   ),
								 ( '00' + dom_item[6].getMinutes() ).substr(-2),
								 ( '00' + dom_item[6].getSeconds() ).substr(-2),
							]
							dom_item[5].innerText = `${dom_item[7][0]}:${dom_item[7][1]}:${dom_item[7][2]}`;
						dom_item[4].appendChild( dom_item[5] );
					dom_item[3].appendChild( dom_item[4] );

						fetch('https://api.github.com/rate_limit', {
							method: 'GET',
							mode: 'cors',
							cache: 'no-cache',
							headers: {
								'Content-Type': 'application/json'
							},
							redirect: 'follow',
							referrerPolicy: 'no-referrer',
						})
						.then((r)=>r.json())
						.then((r)=>{ return r.rate; })
						.then((r)=>{
							console.log(r);
							dom_item[4] = document.createElement('tr');
								dom_item[5] = document.createElement('td');
									dom_item[6] = document.createTextNode( 'GitHub API' );
								dom_item[5].appendChild( dom_item[6] );
							dom_item[4].appendChild( dom_item[5] );
								dom_item[5] = document.createElement('td');
								dom_item[5].innerHTML  = `Remaining: ${r.remaining}/${r.limit} (Use: ${r.used})<br />`;
								dom_item[6] = new Date(r.reset*1000);
								dom_item[7] = [
									(''   +  dom_item[6].getFullYear()  ),
									('00' + (dom_item[6].getMonth() + 1)).substr(-2),
									('00' +  dom_item[6].getDate()      ).substr(-2),
									('00' +  dom_item[6].getHours()     ).substr(-2),
									('00' +  dom_item[6].getMinutes()   ).substr(-2),
									('00' +  dom_item[6].getSeconds()   ).substr(-2),
								];
								dom_item[5].innerHTML += `Reset: ${dom_item[7][0]}/${dom_item[7][1]}/${dom_item[7][2]} ${dom_item[7][3]}:${dom_item[7][4]}:${dom_item[7][5]}<br />`;
							dom_item[4].appendChild( dom_item[5] );
						dom_item[3].appendChild( dom_item[4] );
							return r;
						})

					dom_item[2].appendChild( dom_item[3] );
				dom_item[1].appendChild( dom_item[2] );
				Array.from( document.querySelectorAll( '#' + dom_item[0].id ) ).map( (item)=>{
					item.appendChild(dom_item[1]);
				} )

				insertLastElement();
			}
			function getApiRateOfGithub() {
				fetch('https://api.github.com/rate_limit', {
					method: 'GET',
					mode: 'cors',
					cache: 'no-cache',
					headers: {
						'Content-Type': 'application/json'
					},
					redirect: 'follow',
					referrerPolicy: 'no-referrer',
				})
				.then((r)=>r.json())
				.then((r)=>{ return r.rate; })
				.then((r)=>{
					console.log(r);
					return r;
				})
			}
			window.addEventListener('DOMContentLoaded', (e1)=>{
				getSelfHashThenSetStorage();
				insertTopMaker();
				insertFavicon();
				setInterval( ()=>{ console.log( Math.round(parseInt(new Date().getTime()/1000) / 10) * 10 ); }, 1000);
				document.body.appendChild(createNLevelHeader(1, location.host));
				insertNavigation();
				setTimeout( insertSignature(), 1000);
				getListOfGithubPublicRepos();
				setInterval( getApiRateOfGithub, 10000);
				setTimeout( ()=>{
					setInterval( ()=>{
						buildDebugField();
					}, 250);
				}, 5*1000);
			});
			window.addEventListener('load', (e1)=>{
			});
		</script>
	</head>
	<body></body>
</html>
